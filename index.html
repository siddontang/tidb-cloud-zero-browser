<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TiDB Cloud Zero â€” SQL Editor</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #0f1117;
      --surface: #1a1d27;
      --surface2: #22263a;
      --surface3: #191c2a;
      --border: #2e3350;
      --accent: #f76e3c;
      --text: #e2e8f0;
      --text-muted: #7c85a2;
      --text-faint: #4a5180;
      --green: #4ade80;
      --yellow: #fbbf24;
      --red: #f87171;
      --blue: #60a5fa;
      --purple: #a78bfa;
      --radius: 8px;
      --font-mono: 'JetBrains Mono', 'Fira Code', 'Cascadia Code', ui-monospace, monospace;
      --sidebar-w: 260px;
      --history-w: 190px;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      height: 100dvh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* â”€â”€ Splash â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #splash {
      position: fixed; inset: 0; background: var(--bg);
      display: flex; flex-direction: column; align-items: center;
      justify-content: center; gap: 24px; z-index: 100;
      transition: opacity 0.4s ease;
    }
    #splash.hidden { opacity: 0; pointer-events: none; }
    .splash-logo { display: flex; align-items: center; gap: 12px; font-size: 26px; font-weight: 700; }
    .splash-logo svg { width: 40px; height: 40px; }
    .spinner-wrap { display: flex; flex-direction: column; align-items: center; gap: 16px; }
    .spinner {
      width: 40px; height: 40px;
      border: 3px solid var(--border); border-top-color: var(--accent);
      border-radius: 50%; animation: spin 0.8s linear infinite;
    }
    .spinner-sm {
      width: 20px; height: 20px;
      border: 2px solid var(--border); border-top-color: var(--accent);
      border-radius: 50%; animation: spin 0.8s linear infinite;
      display: inline-block;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    #splash-status { color: var(--text-muted); font-size: 14px; }
    #splash-error {
      display: none; max-width: 460px; background: #2a1414;
      border: 1px solid var(--red); border-radius: var(--radius);
      padding: 16px 20px; color: var(--red); font-size: 13px;
      line-height: 1.6; text-align: center;
    }
    #splash-error button {
      margin-top: 10px; padding: 7px 18px; background: var(--accent);
      color: #fff; border: none; border-radius: 6px; cursor: pointer;
      font-size: 13px; font-weight: 600;
    }

    /* â”€â”€ Top Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #topbar {
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 16px; height: 50px; background: var(--surface);
      border-bottom: 1px solid var(--border); flex-shrink: 0; z-index: 10;
    }
    .topbar-left { display: flex; align-items: center; gap: 10px; }
    .topbar-logo { font-size: 15px; font-weight: 700; letter-spacing: -0.3px; }
    .topbar-logo span { color: var(--accent); }
    .badge {
      font-size: 10px; font-weight: 600; padding: 2px 7px;
      border-radius: 20px; letter-spacing: 0.5px; text-transform: uppercase;
    }
    .badge-preview { background: #221b38; color: var(--purple); border: 1px solid #3d2e6a; }
    .topbar-right { display: flex; align-items: center; gap: 8px; }
    #instance-info { display: flex; align-items: center; gap: 7px; font-size: 12px; color: var(--text-muted); }
    .dot { width: 7px; height: 7px; border-radius: 50%; background: var(--green); flex-shrink: 0; animation: pulse 2s infinite; }
    @keyframes pulse { 0%,100% { opacity:1; } 50% { opacity:0.35; } }
    #expiry { color: var(--yellow); font-size: 12px; }

    .btn {
      display: inline-flex; align-items: center; gap: 5px;
      padding: 6px 12px; border-radius: 6px; border: none;
      font-size: 12px; font-weight: 600; cursor: pointer;
      transition: opacity 0.15s, transform 0.1s;
    }
    .btn:active { transform: scale(0.97); }
    .btn-ghost { background: transparent; color: var(--text-muted); border: 1px solid var(--border); }
    .btn-ghost:hover { color: var(--text); border-color: #4a5080; }
    .btn-run {
      background: linear-gradient(135deg, #f76e3c, #e84545);
      color: #fff; padding: 7px 18px; font-size: 13px;
    }
    .btn-run:disabled { opacity: 0.5; cursor: not-allowed; }

    /* â”€â”€ Welcome Banner â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #welcome-banner {
      background: linear-gradient(135deg, #1a1f38 0%, #1e1530 100%);
      border-bottom: 1px solid #2e3a5a;
      padding: 14px 20px;
      display: flex; align-items: flex-start; gap: 14px;
      flex-shrink: 0;
    }
    #welcome-banner.hidden { display: none; }
    .banner-icon {
      font-size: 24px; flex-shrink: 0; margin-top: 1px;
    }
    .banner-body { flex: 1; min-width: 0; }
    .banner-title { font-size: 14px; font-weight: 700; margin-bottom: 4px; color: var(--text); }
    .banner-desc { font-size: 12.5px; color: var(--text-muted); line-height: 1.6; }
    .banner-pills { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }
    .banner-pill {
      font-size: 11px; padding: 2px 9px; border-radius: 20px;
      font-weight: 600; border: 1px solid;
    }
    .p-green { color: var(--green); border-color: #1a4a2a; background: #0f2a18; }
    .p-blue  { color: var(--blue);  border-color: #1a3060; background: #0f1e40; }
    .p-purple{ color: var(--purple);border-color: #3a2860; background: #221840; }
    .p-yellow{ color: var(--yellow);border-color: #4a3a10; background: #2a2010; }
    .banner-close {
      background: none; border: none; color: var(--text-faint);
      cursor: pointer; font-size: 18px; line-height: 1; padding: 2px 4px;
      flex-shrink: 0; transition: color 0.15s;
    }
    .banner-close:hover { color: var(--text-muted); }

    /* â”€â”€ Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #app { display: flex; flex-direction: column; flex: 1; overflow: hidden; }
    #main-area { display: flex; flex: 1; overflow: hidden; }

    /* â”€â”€ Left Sidebar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #left-sidebar {
      width: var(--sidebar-w); flex-shrink: 0;
      border-right: 1px solid var(--border);
      background: var(--surface3);
      display: flex; flex-direction: column; overflow: hidden;
    }
    .sidebar-section { flex-shrink: 0; }
    .sidebar-section-header {
      padding: 10px 14px 8px;
      font-size: 10px; font-weight: 700; text-transform: uppercase;
      letter-spacing: 1.2px; color: var(--text-faint);
    }

    /* About */
    .about-body { padding: 0 14px 14px; }
    .about-body p { font-size: 12px; color: var(--text-muted); line-height: 1.65; margin-bottom: 8px; }
    .about-body a { color: var(--accent); text-decoration: none; }
    .about-body a:hover { text-decoration: underline; }
    .about-facts { display: flex; flex-direction: column; gap: 5px; }
    .fact {
      display: flex; align-items: center; gap: 7px;
      font-size: 11.5px; color: var(--text-muted);
    }
    .fact-dot { width: 5px; height: 5px; border-radius: 50%; flex-shrink: 0; }

    .sidebar-divider { height: 1px; background: var(--border); margin: 4px 0; }

    /* Demo cards */
    #demos-list { overflow-y: auto; flex: 1; padding: 0 10px 12px; }
    .demo-card {
      border: 1px solid var(--border); border-radius: 8px;
      margin-bottom: 8px; overflow: hidden;
      transition: border-color 0.15s;
      cursor: pointer;
    }
    .demo-card:hover { border-color: #4a5580; }
    .demo-card.active { border-color: var(--accent); }
    .demo-card-header {
      display: flex; align-items: center; gap: 8px;
      padding: 9px 11px; background: var(--surface2);
    }
    .demo-icon { font-size: 16px; flex-shrink: 0; }
    .demo-card-title { font-size: 12px; font-weight: 700; color: var(--text); flex: 1; }
    .demo-card-body {
      padding: 8px 11px 10px;
      background: var(--surface3);
    }
    .demo-card-desc { font-size: 11px; color: var(--text-muted); line-height: 1.55; margin-bottom: 8px; }
    .demo-card-footer { display: flex; gap: 6px; }
    .demo-btn {
      flex: 1; padding: 5px 0; border-radius: 5px; border: none;
      font-size: 11px; font-weight: 600; cursor: pointer;
      transition: opacity 0.15s;
    }
    .demo-btn:hover { opacity: 0.85; }
    .demo-btn-load { background: var(--surface2); color: var(--text-muted); border: 1px solid var(--border); }
    .demo-btn-run  { background: var(--accent); color: #fff; }

    /* â”€â”€ Center: Editor + Results â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #center-area { display: flex; flex-direction: column; flex: 1; overflow: hidden; }

    #editor-pane { display: flex; flex-direction: column; border-bottom: 1px solid var(--border); flex-shrink: 0; }
    .editor-toolbar {
      display: flex; align-items: center; justify-content: space-between;
      padding: 7px 14px; background: var(--surface); border-bottom: 1px solid var(--border);
    }
    .editor-toolbar-left { display: flex; align-items: center; gap: 10px; }
    .toolbar-label { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; color: var(--text-faint); }
    .hint { font-size: 11px; color: var(--text-faint); }
    .hint kbd {
      background: var(--surface2); border: 1px solid var(--border);
      border-radius: 3px; padding: 1px 4px; font-family: var(--font-mono); font-size: 10px;
    }
    #active-demo-label {
      font-size: 11px; color: var(--accent); font-weight: 600;
      padding: 2px 8px; background: rgba(247,110,60,0.1);
      border-radius: 4px; display: none;
    }
    #sql-editor {
      width: 100%; min-height: 150px; max-height: 260px; resize: vertical;
      background: #13151f; color: var(--text); border: none; outline: none;
      padding: 14px 16px; font-family: var(--font-mono); font-size: 13.5px;
      line-height: 1.65; tab-size: 2; caret-color: var(--accent);
    }
    #sql-editor::placeholder { color: var(--text-faint); }
    #sql-editor:focus { background: #12141e; }

    /* â”€â”€ Results â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #results-pane { display: flex; flex-direction: column; flex: 1; overflow: hidden; }
    .results-toolbar {
      display: flex; align-items: center; justify-content: space-between;
      padding: 7px 14px; background: var(--surface);
      border-bottom: 1px solid var(--border); flex-shrink: 0;
    }
    .results-meta { display: flex; align-items: center; gap: 8px; }
    .meta-pill { font-size: 11px; padding: 2px 9px; border-radius: 20px; font-weight: 600; }
    .pill-rows     { background: #0f1e40; color: var(--blue); }
    .pill-time     { background: #0f2318; color: var(--green); }
    .pill-affected { background: #2a2010; color: var(--yellow); }
    .pill-error    { background: #2a1010; color: var(--red); }
    #results-scroll { overflow: auto; flex: 1; }
    #results-container { padding: 14px; min-height: 100%; }

    .empty-state {
      display: flex; flex-direction: column; align-items: center;
      justify-content: center; height: 140px; gap: 10px; color: var(--text-faint);
    }
    .empty-state p { font-size: 13px; }

    .result-table-wrap { overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; font-size: 12.5px; font-family: var(--font-mono); }
    thead th {
      background: var(--surface2); color: var(--text-muted); font-weight: 600;
      text-align: left; padding: 8px 13px; border-bottom: 1px solid var(--border);
      white-space: nowrap; font-size: 10.5px; text-transform: uppercase;
      letter-spacing: 0.5px; position: sticky; top: 0; z-index: 1;
    }
    tbody tr:hover { background: var(--surface); }
    tbody tr:nth-child(even) { background: rgba(255,255,255,0.014); }
    tbody tr:nth-child(even):hover { background: var(--surface); }
    td {
      padding: 7px 13px; border-bottom: 1px solid #1b1e32; color: var(--text);
      white-space: nowrap; max-width: 380px; overflow: hidden; text-overflow: ellipsis;
    }
    td.null-val { color: var(--text-faint); font-style: italic; }
    td.num-val  { color: #93c5fd; }
    td.str-val  { color: #86efac; }

    .error-box {
      background: #1e0f0f; border: 1px solid #5c2020; border-radius: var(--radius);
      padding: 14px; color: var(--red); font-family: var(--font-mono);
      font-size: 12.5px; line-height: 1.7; white-space: pre-wrap;
    }
    .success-box {
      background: #0f1e0f; border: 1px solid #1e4a1e; border-radius: var(--radius);
      padding: 14px; color: var(--green); font-size: 13.5px; line-height: 1.6;
    }
    .multi-result { display: flex; flex-direction: column; gap: 12px; }
    .stmt-result-label {
      font-size: 10px; font-weight: 700; text-transform: uppercase;
      letter-spacing: 0.8px; color: var(--text-faint); margin-bottom: 5px;
    }

    /* â”€â”€ Right: History â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #history-pane {
      width: var(--history-w); flex-shrink: 0;
      border-left: 1px solid var(--border);
      background: var(--surface3); display: flex; flex-direction: column; overflow: hidden;
    }
    .history-header {
      padding: 10px 13px; font-size: 10px; font-weight: 700;
      text-transform: uppercase; letter-spacing: 1.2px; color: var(--text-faint);
      border-bottom: 1px solid var(--border); flex-shrink: 0;
    }
    #history-list { overflow-y: auto; flex: 1; }
    .history-item {
      padding: 9px 13px; border-bottom: 1px solid #191c28;
      cursor: pointer; font-family: var(--font-mono); font-size: 10.5px;
      color: var(--text-muted); overflow: hidden; text-overflow: ellipsis;
      white-space: nowrap; transition: background 0.1s, color 0.1s;
    }
    .history-item:hover { background: var(--surface2); color: var(--text); }
    .history-empty { padding: 20px 13px; font-size: 11px; color: var(--text-faint); text-align: center; }

    /* â”€â”€ Connection Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #conn-modal {
      display: none; position: fixed; inset: 0;
      background: rgba(0,0,0,0.65); z-index: 200;
      align-items: center; justify-content: center;
    }
    #conn-modal.open { display: flex; }
    .modal-box {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 12px; padding: 22px; width: 540px; max-width: 92vw;
    }
    .modal-title {
      font-size: 15px; font-weight: 700; margin-bottom: 16px;
      display: flex; align-items: center; justify-content: space-between;
    }
    .modal-close { cursor: pointer; color: var(--text-muted); font-size: 20px; line-height: 1; }
    .conn-row { display: flex; flex-direction: column; gap: 4px; margin-bottom: 12px; }
    .conn-label { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.8px; color: var(--text-faint); }
    .conn-value {
      background: var(--surface2); border: 1px solid var(--border); border-radius: 6px;
      padding: 8px 11px; font-family: var(--font-mono); font-size: 12.5px; color: var(--text);
      word-break: break-all; cursor: text; user-select: all;
    }
    .modal-note { font-size: 11.5px; color: var(--text-faint); margin-top: 4px; line-height: 1.5; }
  </style>
</head>
<body>

<!-- â”€â”€ Splash â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="splash">
  <div class="splash-logo">
    <svg viewBox="0 0 40 40" fill="none">
      <rect width="40" height="40" rx="10" fill="#f76e3c" fill-opacity="0.15"/>
      <path d="M20 6L34 14V26L20 34L6 26V14L20 6Z" stroke="#f76e3c" stroke-width="2"/>
      <path d="M20 6v28M6 14h28M6 26h28" stroke="#f76e3c" stroke-width="1.5" stroke-opacity="0.4"/>
    </svg>
    TiDB Cloud <span style="color:var(--accent)">Zero</span>
  </div>
  <div class="spinner-wrap">
    <div class="spinner"></div>
    <div id="splash-status">Initializingâ€¦</div>
  </div>
  <div id="splash-error">
    <strong>Failed to provision instance</strong><br>
    <span id="splash-error-msg"></span><br>
    <button onclick="retryInit()">Retry</button>
  </div>
</div>

<!-- â”€â”€ App â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="app" style="display:none">

  <!-- Top bar -->
  <div id="topbar">
    <div class="topbar-left">
      <div class="topbar-logo">TiDB Cloud <span>Zero</span></div>
      <span class="badge badge-preview">Technical Preview</span>
    </div>
    <div class="topbar-right">
      <div id="instance-info">
        <div class="dot"></div>
        <span id="expiry"></span>
      </div>
      <button class="btn btn-ghost" onclick="showConnModal()">Connection</button>
      <button class="btn btn-ghost" onclick="newInstance()">New Instance</button>
    </div>
  </div>

  <!-- Welcome banner -->
  <div id="welcome-banner">
    <div class="banner-icon">âš¡</div>
    <div class="banner-body">
      <div class="banner-title">Your TiDB Cloud Zero database is ready</div>
      <div class="banner-desc">
        A full MySQL-compatible database provisioned in milliseconds â€” no signup, no config.
        Use the SQL editor below to run queries, or pick a demo from the left panel to explore
        common use cases like AI agent memory and vector search. Your instance expires in ~30 days.
      </div>
      <div class="banner-pills">
        <span class="banner-pill p-green">MySQL 8.0 compatible</span>
        <span class="banner-pill p-blue">Vector search</span>
        <span class="banner-pill p-purple">Full-text search</span>
        <span class="banner-pill p-yellow">30-day TTL Â· No signup</span>
      </div>
    </div>
    <button class="banner-close" onclick="dismissBanner()" title="Dismiss">Ã—</button>
  </div>

  <!-- Main content -->
  <div id="main-area">

    <!-- Left sidebar: About + Demos -->
    <div id="left-sidebar">
      <div class="sidebar-section">
        <div class="sidebar-section-header">About</div>
        <div class="about-body">
          <p>
            <a href="https://zero.tidbcloud.com" target="_blank">TiDB Cloud Zero</a> gives you
            a disposable, full-featured database in milliseconds. Perfect for prototyping,
            AI agents, and experiments.
          </p>
          <div class="about-facts">
            <div class="fact"><div class="fact-dot" style="background:var(--green)"></div>Instant provisioning, no signup</div>
            <div class="fact"><div class="fact-dot" style="background:var(--blue)"></div>MySQL-compatible (TiDB 8.0)</div>
            <div class="fact"><div class="fact-dot" style="background:var(--purple)"></div>Native vector &amp; full-text search</div>
            <div class="fact"><div class="fact-dot" style="background:var(--yellow)"></div>Auto-expires after 30 days</div>
            <div class="fact"><div class="fact-dot" style="background:var(--accent)"></div>One shared instance per session</div>
          </div>
        </div>
      </div>

      <div class="sidebar-divider"></div>

      <div class="sidebar-section" style="flex:1;display:flex;flex-direction:column;overflow:hidden">
        <div class="sidebar-section-header">Demo Scenarios</div>
        <div id="demos-list">

          <!-- Demo 1: Quick Start -->
          <div class="demo-card" id="demo-card-0">
            <div class="demo-card-header">
              <span class="demo-icon">ğŸš€</span>
              <span class="demo-card-title">Quick Start</span>
            </div>
            <div class="demo-card-body">
              <div class="demo-card-desc">Create a table, insert rows, and run your first SELECT. The perfect starting point.</div>
              <div class="demo-card-footer">
                <button class="demo-btn demo-btn-load" onclick="loadDemo(0)">Load</button>
                <button class="demo-btn demo-btn-run"  onclick="loadAndRunDemo(0)">Run All</button>
              </div>
            </div>
          </div>

          <!-- Demo 2: AI Agent Memory -->
          <div class="demo-card" id="demo-card-1">
            <div class="demo-card-header">
              <span class="demo-icon">ğŸ§ </span>
              <span class="demo-card-title">AI Agent Memory</span>
            </div>
            <div class="demo-card-body">
              <div class="demo-card-desc">Store and retrieve conversation history for AI agents across sessions â€” with importance ranking.</div>
              <div class="demo-card-footer">
                <button class="demo-btn demo-btn-load" onclick="loadDemo(1)">Load</button>
                <button class="demo-btn demo-btn-run"  onclick="loadAndRunDemo(1)">Run All</button>
              </div>
            </div>
          </div>

          <!-- Demo 3: Vector Search -->
          <div class="demo-card" id="demo-card-2">
            <div class="demo-card-header">
              <span class="demo-icon">ğŸ”</span>
              <span class="demo-card-title">Vector Search</span>
            </div>
            <div class="demo-card-body">
              <div class="demo-card-desc">Store document embeddings and find semantically similar content using TiDB's built-in VECTOR type.</div>
              <div class="demo-card-footer">
                <button class="demo-btn demo-btn-load" onclick="loadDemo(2)">Load</button>
                <button class="demo-btn demo-btn-run"  onclick="loadAndRunDemo(2)">Run All</button>
              </div>
            </div>
          </div>

          <!-- Demo 4: Agent State -->
          <div class="demo-card" id="demo-card-3">
            <div class="demo-card-header">
              <span class="demo-icon">ğŸ—„ï¸</span>
              <span class="demo-card-title">Agent State Store</span>
            </div>
            <div class="demo-card-body">
              <div class="demo-card-desc">Persist structured key-value state for AI agents between runs using JSON columns and upserts.</div>
              <div class="demo-card-footer">
                <button class="demo-btn demo-btn-load" onclick="loadDemo(3)">Load</button>
                <button class="demo-btn demo-btn-run"  onclick="loadAndRunDemo(3)">Run All</button>
              </div>
            </div>
          </div>

          <!-- Demo 5: Agent Tool Call Log -->
          <div class="demo-card" id="demo-card-4">
            <div class="demo-card-header">
              <span class="demo-icon">ğŸ“Š</span>
              <span class="demo-card-title">Agent Tool Call Log</span>
            </div>
            <div class="demo-card-body">
              <div class="demo-card-desc">Time-series log of every tool an AI agent calls â€” with latency tracking and a per-tool performance report.</div>
              <div class="demo-card-footer">
                <button class="demo-btn demo-btn-load" onclick="loadDemo(4)">Load</button>
                <button class="demo-btn demo-btn-run"  onclick="loadAndRunDemo(4)">Run All</button>
              </div>
            </div>
          </div>

        </div><!-- /demos-list -->
      </div>
    </div><!-- /left-sidebar -->

    <!-- Center: editor + results -->
    <div id="center-area">
      <div id="editor-pane">
        <div class="editor-toolbar">
          <div class="editor-toolbar-left">
            <span class="toolbar-label">SQL Editor</span>
            <span id="active-demo-label"></span>
            <span class="hint"><kbd>Ctrl</kbd>+<kbd>Enter</kbd> to run</span>
          </div>
          <div style="display:flex;gap:6px;align-items:center">
            <button class="btn btn-ghost" onclick="clearEditor()">Clear</button>
            <button class="btn btn-run" id="run-btn" onclick="runQuery()">â–¶ Run</button>
          </div>
        </div>
        <textarea
          id="sql-editor"
          spellcheck="false"
          autocomplete="off"
          autocorrect="off"
          placeholder="-- Write SQL here, e.g.:
-- SELECT version();
-- CREATE TABLE test (id INT PRIMARY KEY AUTO_INCREMENT, val TEXT);
--
-- Tip: pick a demo from the left panel to get started instantly."
        ></textarea>
      </div>

      <div id="results-pane">
        <div class="results-toolbar">
          <span class="toolbar-label">Results</span>
          <div class="results-meta" id="results-meta"></div>
        </div>
        <div id="results-scroll">
          <div id="results-container">
            <div class="empty-state">
              <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.3">
                <rect x="3" y="3" width="18" height="18" rx="2"/>
                <path d="M3 9h18M3 15h18M9 3v18"/>
              </svg>
              <p>Run a query to see results</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right: history -->
    <div id="history-pane">
      <div class="history-header">History</div>
      <div id="history-list">
        <div class="history-empty">No queries yet</div>
      </div>
    </div>

  </div><!-- /main-area -->
</div><!-- /app -->

<!-- Connection modal -->
<div id="conn-modal">
  <div class="modal-box">
    <div class="modal-title">
      Connection Details
      <span class="modal-close" onclick="closeConnModal()">Ã—</span>
    </div>
    <div class="conn-row"><div class="conn-label">Connection String</div><div class="conn-value" id="modal-connstr"></div></div>
    <div class="conn-row"><div class="conn-label">Host</div><div class="conn-value" id="modal-host"></div></div>
    <div class="conn-row"><div class="conn-label">Username</div><div class="conn-value" id="modal-user"></div></div>
    <div class="conn-row"><div class="conn-label">Password</div><div class="conn-value" id="modal-pass"></div></div>
    <div class="conn-row"><div class="conn-label">Database</div><div class="conn-value" id="modal-db"></div></div>
    <div class="conn-row"><div class="conn-label">Expires At</div><div class="conn-value" id="modal-expires"></div></div>
    <p class="modal-note">Click any field to select all. Connect with any MySQL client using TLS on port 4000.</p>
  </div>
</div>

<script>
  const STORAGE_KEY  = 'tidb-zero-instance-v1';
  const BANNER_KEY   = 'tidb-zero-banner-dismissed';

  let dbConfig      = null;
  let queryHistory  = [];
  let activeDemoIdx = -1;

  // â”€â”€ Demo Definitions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  const DEMOS = [
    {
      name: 'ğŸš€ Quick Start',
      statements: [
        `-- Create a simple table
CREATE TABLE IF NOT EXISTS messages (
  id         BIGINT PRIMARY KEY AUTO_INCREMENT,
  text       VARCHAR(500) NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
)`,
        `-- Insert some rows
INSERT INTO messages (text) VALUES
  ('Hello from TiDB Cloud Zero!'),
  ('Zero config. Zero signup. Ready in milliseconds.'),
  ('MySQL-compatible â€” use any MySQL client or ORM.')`,
        `-- Query the data
SELECT id, text, created_at FROM messages ORDER BY id`,
      ],
    },
    {
      name: 'ğŸ§  AI Agent Memory',
      statements: [
        `-- Long-term memory store for AI agents.
-- Persists conversation history and facts across sessions.
CREATE TABLE IF NOT EXISTS agent_memories (
  id          BIGINT PRIMARY KEY AUTO_INCREMENT,
  session_id  VARCHAR(64) NOT NULL,
  role        ENUM('system','user','assistant') NOT NULL,
  content     TEXT NOT NULL,
  importance  TINYINT DEFAULT 5 COMMENT '1=low, 10=critical',
  created_at  TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_session (session_id, created_at)
)`,
        `-- Simulate storing a conversation
INSERT INTO agent_memories (session_id, role, content, importance) VALUES
  ('sess_demo', 'system',    'You are a helpful assistant with persistent memory.', 10),
  ('sess_demo', 'user',      'My name is Alice and I prefer concise answers.',       9),
  ('sess_demo', 'assistant', 'Noted, Alice â€” I will keep responses brief.',          5),
  ('sess_demo', 'user',      'I am building a distributed database system.',         9),
  ('sess_demo', 'assistant', 'Great â€” I will tailor answers to distributed systems.',5),
  ('sess_demo', 'user',      'What databases support vector search natively?',       7),
  ('sess_demo', 'assistant', 'TiDB, pgvector, and Pinecone are popular options.',    6)`,
        `-- Retrieve high-priority memories for the agent context window
SELECT role, content, importance, created_at
FROM   agent_memories
WHERE  session_id = 'sess_demo'
ORDER  BY importance DESC, created_at ASC`,
      ],
    },
    {
      name: 'ğŸ” Vector Search',
      statements: [
        `-- Semantic similarity search using TiDB's native VECTOR type.
-- In production, use 1536-dim embeddings from OpenAI / similar.
CREATE TABLE IF NOT EXISTS knowledge_base (
  id         BIGINT PRIMARY KEY AUTO_INCREMENT,
  title      VARCHAR(255)  NOT NULL,
  content    TEXT          NOT NULL,
  embedding  VECTOR(4)     NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
)`,
        `-- Store documents with embeddings
INSERT INTO knowledge_base (title, content, embedding) VALUES
  ('TiDB Overview',    'TiDB is a distributed NewSQL database for HTAP workloads.',       '[0.92, 0.11, 0.34, 0.78]'),
  ('MySQL Basics',     'MySQL is the most popular open-source relational database.',       '[0.88, 0.15, 0.32, 0.72]'),
  ('Redis Guide',      'Redis is an in-memory key-value store used for caching.',         '[0.21, 0.85, 0.67, 0.12]'),
  ('Vector Databases', 'Vector DBs enable semantic search over high-dim embeddings.',     '[0.45, 0.33, 0.91, 0.55]'),
  ('AI Agent Memory',  'AI agents use databases to persist memory between sessions.',     '[0.50, 0.30, 0.88, 0.60]'),
  ('RAG Systems',      'Retrieval-augmented generation grounds LLM answers in real data.','[0.48, 0.29, 0.86, 0.62]')`,
        `-- Semantic search: find docs closest to "AI memory and databases"
-- (query vector is a synthetic embedding for that concept)
SELECT
  title,
  content,
  ROUND(VEC_COSINE_DISTANCE(embedding, '[0.48, 0.32, 0.90, 0.58]'), 4) AS distance
FROM   knowledge_base
ORDER  BY distance ASC
LIMIT  3`,
      ],
    },
    {
      name: 'ğŸ—„ï¸ Agent State Store',
      statements: [
        `-- Persistent key-value store for AI agent state.
-- JSON column lets agents store structured data per key.
CREATE TABLE IF NOT EXISTS agent_state (
  agent_id   VARCHAR(64)  NOT NULL,
  key_name   VARCHAR(255) NOT NULL,
  value      JSON,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (agent_id, key_name)
)`,
        `-- Agent writes its state after each run (upsert)
INSERT INTO agent_state (agent_id, key_name, value) VALUES
  ('planner_v1', 'status',      '"active"'),
  ('planner_v1', 'task_count',  '42'),
  ('planner_v1', 'last_action', '"web_search"'),
  ('planner_v1', 'context',     '{"goal":"Research TiDB Zero","steps_done":3,"next":"summarize"}'),
  ('planner_v1', 'tools_used',  '["web_search","code_runner","memory_store"]'),
  ('planner_v1', 'error_count', '0')
ON DUPLICATE KEY UPDATE
  value      = VALUES(value),
  updated_at = NOW()`,
        `-- Agent reads full state on next wake-up
SELECT
  key_name,
  value,
  updated_at
FROM   agent_state
WHERE  agent_id = 'planner_v1'
ORDER  BY key_name`,
      ],
    },
    {
      name: 'ğŸ“Š Agent Tool Call Log',
      statements: [
        `-- Time-series event log for AI agent tool calls.
-- Track every action an agent takes with latency and status.
CREATE TABLE IF NOT EXISTS tool_calls (
  id         BIGINT PRIMARY KEY AUTO_INCREMENT,
  agent_id   VARCHAR(64)  NOT NULL,
  tool_name  VARCHAR(100) NOT NULL,
  input      JSON,
  output     JSON,
  status     ENUM('success','error','timeout') DEFAULT 'success',
  latency_ms INT          NOT NULL DEFAULT 0,
  called_at  TIMESTAMP    DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_agent  (agent_id, called_at),
  INDEX idx_tool   (tool_name, called_at)
)`,
        `-- Simulate a series of agent tool calls
INSERT INTO tool_calls (agent_id, tool_name, input, output, status, latency_ms) VALUES
  ('agent_01', 'web_search',    '{"query":"TiDB vector search"}',         '{"results":3}',           'success', 320),
  ('agent_01', 'memory_read',   '{"session":"sess_demo","limit":5}',      '{"memories":5}',          'success',  12),
  ('agent_01', 'code_runner',   '{"lang":"python","code":"print(1+1)"}',  '{"output":"2"}',          'success', 890),
  ('agent_01', 'web_search',    '{"query":"serverless databases 2025"}',  '{"results":7}',           'success', 415),
  ('agent_01', 'memory_write',  '{"content":"TiDB supports VECTOR type"}','{"saved":true}',          'success',   8),
  ('agent_01', 'code_runner',   '{"lang":"sql","code":"SELECT 1"}',       '{"error":"timeout"}',     'timeout',5000),
  ('agent_02', 'web_search',    '{"query":"AI agent frameworks"}',        '{"results":12}',          'success', 280),
  ('agent_02', 'memory_read',   '{"session":"sess_02","limit":10}',       '{"memories":2}',          'success',   9),
  ('agent_02', 'file_write',    '{"path":"report.md"}',                   '{"bytes":2048}',          'success', 145)`,
        `-- Aggregate: tool performance report per agent
SELECT
  agent_id,
  tool_name,
  COUNT(*)                                      AS calls,
  SUM(status = 'success')                       AS success,
  SUM(status = 'error') + SUM(status='timeout') AS failures,
  ROUND(AVG(latency_ms))                        AS avg_ms,
  MAX(latency_ms)                               AS max_ms
FROM   tool_calls
GROUP  BY agent_id, tool_name
ORDER  BY agent_id, calls DESC`,
      ],
    },
  ];

  // â”€â”€ Instance Management â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  async function fetchInstance(forceNew = false) {
    setSplashStatus(forceNew ? 'Provisioning new instanceâ€¦' : 'Connecting to TiDB Cloud Zeroâ€¦');
    const res = await fetch('/api/instance', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ force: forceNew }),
    });
    if (!res.ok) throw new Error(`API ${res.status}: ${await res.text()}`);
    return res.json();
  }

  function parseConnectionString(connStr) {
    const url = new URL(connStr);
    return {
      host:     url.hostname,
      username: decodeURIComponent(url.username),
      password: decodeURIComponent(url.password),
      database: url.pathname.replace(/^\//, '') || 'test',
    };
  }

  function isExpired(expiresAt) {
    return !expiresAt || new Date(expiresAt) <= new Date(Date.now() + 5 * 60_000);
  }

  // â”€â”€ SQL Execution â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  async function executeSQL(sql) {
    const { host, username, password, database } = dbConfig;
    const res = await fetch('/api/sql', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ host, username, password, database, query: sql }),
    });
    if (!res.ok) {
      const text = await res.text();
      throw new Error(text || `HTTP ${res.status}`);
    }
    return res.json();
  }

  // Split SQL on semicolons (respects simple string literals, skips comments)
  function splitStatements(sql) {
    // Strip -- line comments, then split on ;
    const stripped = sql.replace(/--[^\n]*/g, '');
    return stripped.split(';').map(s => s.trim()).filter(s => s.length > 0);
  }

  // â”€â”€ Run Query â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  async function runQuery() {
    const raw = document.getElementById('sql-editor').value.trim();
    if (!raw) return;

    const btn = document.getElementById('run-btn');
    btn.disabled = true;
    btn.innerHTML = '<span class="spinner-sm"></span> Runningâ€¦';

    setResultsMeta([]);
    setResultsContent('<div class="empty-state"><div class="spinner"></div></div>');

    const statements = splitStatements(raw);
    const t0 = Date.now();

    try {
      if (statements.length === 1) {
        const result  = await executeSQL(statements[0]);
        const elapsed = Date.now() - t0;
        renderResult(result, elapsed);
      } else {
        await runMultiple(statements, t0);
      }
      addHistory(raw);
    } catch (err) {
      setResultsMeta([{ label: 'Error', cls: 'pill-error' }]);
      setResultsContent(`<div class="error-box">${escHtml(err.message)}</div>`);
    } finally {
      btn.disabled = false;
      btn.textContent = 'â–¶ Run';
    }
  }

  async function runMultiple(statements, t0) {
    const results = [];
    for (let i = 0; i < statements.length; i++) {
      const stmt = statements[i];
      setResultsContent(`<div class="empty-state"><div class="spinner"></div><p>Running statement ${i + 1} / ${statements.length}â€¦</p></div>`);
      const result = await executeSQL(stmt);
      results.push({ stmt, result });
    }
    const elapsed = Date.now() - t0;

    // Show only the last meaningful result (SELECT), or summary of DML
    const last = results[results.length - 1];
    const hasRows = last.result.types && last.result.rows !== undefined;

    if (hasRows) {
      setResultsMeta([
        { label: `${statements.length} statements`, cls: 'pill-affected' },
        { label: `${elapsed}ms total`, cls: 'pill-time' },
      ]);
      renderSelectResult(last.result, elapsed, false);
    } else {
      // Summarise all DML
      const totalAffected = results.reduce((s, r) => s + (r.result.rowsAffected ?? 0), 0);
      setResultsMeta([
        { label: `${statements.length} statements`, cls: 'pill-affected' },
        { label: `${totalAffected} rows affected`, cls: 'pill-affected' },
        { label: `${elapsed}ms`, cls: 'pill-time' },
      ]);
      const summaryHtml = results.map((r, i) => {
        const aff = r.result.rowsAffected ?? 0;
        const preview = r.stmt.replace(/\s+/g, ' ').slice(0, 60);
        return `<div style="padding:6px 0;border-bottom:1px solid #1b1e32;font-size:12px;font-family:var(--font-mono)">
          <span style="color:var(--text-faint)">${i + 1}.</span>
          <span style="color:var(--text-muted)">${escHtml(preview)}â€¦</span>
          <span style="color:var(--green);float:right">${aff} affected</span>
        </div>`;
      }).join('');
      setResultsContent(`<div>${summaryHtml}</div>`);
    }
  }

  function renderResult(result, elapsed) {
    if (result.types && result.rows !== undefined) {
      const count = result.rows ? result.rows.length : 0;
      setResultsMeta([
        { label: `${count} row${count !== 1 ? 's' : ''}`, cls: 'pill-rows' },
        { label: `${elapsed}ms`, cls: 'pill-time' },
      ]);
      renderSelectResult(result, elapsed, true);
    } else {
      const affected = result.rowsAffected ?? 0;
      const insertId = result.lastInsertID ?? result.lastInsertId ?? null;
      setResultsMeta([
        { label: `${affected} affected`, cls: 'pill-affected' },
        { label: `${elapsed}ms`, cls: 'pill-time' },
      ]);
      let msg = `Query OK â€” <strong>${affected}</strong> row${affected !== 1 ? 's' : ''} affected`;
      if (insertId !== null && insertId !== 0) msg += ` &nbsp;Â·&nbsp; Last insert ID: <strong>${insertId}</strong>`;
      setResultsContent(`<div class="success-box">${msg}</div>`);
    }
  }

  function renderSelectResult(result, elapsed, updateMeta) {
    const cols  = result.types;
    const rows  = result.rows || [];
    const count = rows.length;

    if (updateMeta) {
      setResultsMeta([
        { label: `${count} row${count !== 1 ? 's' : ''}`, cls: 'pill-rows' },
        { label: `${elapsed}ms`, cls: 'pill-time' },
      ]);
    }

    if (count === 0) {
      setResultsContent('<div class="empty-state"><p>Query returned 0 rows</p></div>');
      return;
    }

    let html = '<div class="result-table-wrap"><table><thead><tr>';
    for (const col of cols) html += `<th>${escHtml(col.name)}</th>`;
    html += '</tr></thead><tbody>';

    for (const row of rows) {
      html += '<tr>';
      for (let i = 0; i < cols.length; i++) {
        const val = row[i];
        if (val === null || val === undefined) {
          html += '<td class="null-val">NULL</td>';
        } else {
          const type  = (cols[i].type || '').toLowerCase();
          const isNum = /int|float|double|decimal|bigint|tinyint|smallint/.test(type);
          const cls   = isNum ? 'num-val' : 'str-val';
          html += `<td class="${cls}" title="${escHtml(String(val))}">${escHtml(String(val))}</td>`;
        }
      }
      html += '</tr>';
    }
    html += '</tbody></table></div>';
    setResultsContent(html);
  }

  // â”€â”€ Demo Loading â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  function loadDemo(idx) {
    const demo = DEMOS[idx];
    const sql  = demo.statements.join(';\n\n') + ';';
    document.getElementById('sql-editor').value = sql;
    document.getElementById('sql-editor').focus();
    setActiveDemo(idx);
  }

  async function loadAndRunDemo(idx) {
    loadDemo(idx);
    await runQuery();
  }

  function setActiveDemo(idx) {
    activeDemoIdx = idx;
    document.querySelectorAll('.demo-card').forEach((c, i) => {
      c.classList.toggle('active', i === idx);
    });
    const label = document.getElementById('active-demo-label');
    if (idx >= 0) {
      label.textContent = DEMOS[idx].name;
      label.style.display = 'inline-block';
    } else {
      label.style.display = 'none';
    }
  }

  // â”€â”€ UI Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  function setSplashStatus(msg) { document.getElementById('splash-status').textContent = msg; }

  function showApp() {
    const splash = document.getElementById('splash');
    splash.classList.add('hidden');
    setTimeout(() => { splash.style.display = 'none'; }, 400);
    document.getElementById('app').style.cssText = 'display:flex;flex-direction:column;flex:1';
    if (localStorage.getItem(BANNER_KEY) === '1') {
      document.getElementById('welcome-banner').classList.add('hidden');
    }
  }

  function showSplashError(msg) {
    document.querySelector('.spinner-wrap').style.display = 'none';
    document.getElementById('splash-error').style.display = 'block';
    document.getElementById('splash-error-msg').textContent = msg;
  }

  function dismissBanner() {
    document.getElementById('welcome-banner').classList.add('hidden');
    localStorage.setItem(BANNER_KEY, '1');
  }

  function setResultsMeta(items) {
    document.getElementById('results-meta').innerHTML = items.map(i =>
      `<span class="meta-pill ${i.cls}">${i.label}</span>`
    ).join('');
  }

  function setResultsContent(html) {
    document.getElementById('results-container').innerHTML = html;
  }

  function updateInstanceUI(instance) {
    const expires   = new Date(instance.expiresAt);
    const msLeft   = expires - Date.now();
    const daysLeft = msLeft / 86_400_000;
    const expiryLabel = daysLeft >= 1
      ? `Expires in ${daysLeft.toFixed(1)}d`
      : `Expires in ${(msLeft / 3_600_000).toFixed(1)}h`;
    document.getElementById('expiry').textContent = expiryLabel;
    const cfg = parseConnectionString(instance.connectionString);
    document.getElementById('modal-connstr').textContent = instance.connectionString;
    document.getElementById('modal-host').textContent    = cfg.host;
    document.getElementById('modal-user').textContent    = cfg.username;
    document.getElementById('modal-pass').textContent    = cfg.password;
    document.getElementById('modal-db').textContent      = cfg.database;
    document.getElementById('modal-expires').textContent = expires.toLocaleString();
  }

  function clearEditor() {
    document.getElementById('sql-editor').value = '';
    document.getElementById('sql-editor').focus();
    setActiveDemo(-1);
  }

  function addHistory(sql) {
    const short = sql.replace(/--[^\n]*/g, '').replace(/\s+/g, ' ').trim().slice(0, 70);
    if (!short) return;
    queryHistory.unshift(short);
    if (queryHistory.length > 60) queryHistory.pop();
    renderHistory();
  }

  function renderHistory() {
    const list = document.getElementById('history-list');
    if (queryHistory.length === 0) {
      list.innerHTML = '<div class="history-empty">No queries yet</div>';
      return;
    }
    list.innerHTML = queryHistory.map((q, i) =>
      `<div class="history-item" title="${escHtml(q)}" onclick="loadHistoryItem(${i})">${escHtml(q)}</div>`
    ).join('');
  }

  function loadHistoryItem(idx) {
    document.getElementById('sql-editor').value = queryHistory[idx];
    setActiveDemo(-1);
  }

  function showConnModal()  { document.getElementById('conn-modal').classList.add('open'); }
  function closeConnModal() { document.getElementById('conn-modal').classList.remove('open'); }

  function escHtml(str) {
    return String(str)
      .replace(/&/g,'&amp;').replace(/</g,'&lt;')
      .replace(/>/g,'&gt;').replace(/"/g,'&quot;');
  }

  // â”€â”€ Keyboard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  document.getElementById('conn-modal').addEventListener('click', e => {
    if (e.target === document.getElementById('conn-modal')) closeConnModal();
  });

  document.getElementById('sql-editor').addEventListener('keydown', e => {
    if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') { e.preventDefault(); runQuery(); }
    if (e.key === 'Tab') {
      e.preventDefault();
      const ta = e.target, s = ta.selectionStart, en = ta.selectionEnd;
      ta.value = ta.value.slice(0, s) + '  ' + ta.value.slice(en);
      ta.selectionStart = ta.selectionEnd = s + 2;
    }
  });

  // Clear active demo label when user edits manually
  document.getElementById('sql-editor').addEventListener('input', () => {
    if (activeDemoIdx >= 0) setActiveDemo(-1);
  });

  // â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  async function init(forceNew = false) {
    if (!forceNew) {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (raw) {
          const parsed = JSON.parse(raw);
          if (!isExpired(parsed.expiresAt)) {
            setSplashStatus('Reconnecting to existing instanceâ€¦');
            dbConfig = parseConnectionString(parsed.connectionString);
            updateInstanceUI(parsed);
            showApp();
            return;
          }
        }
      } catch (_) {}
    }

    try {
      const instance = await fetchInstance(forceNew);
      localStorage.setItem(STORAGE_KEY, JSON.stringify(instance));
      dbConfig = parseConnectionString(instance.connectionString);
      updateInstanceUI(instance);
      showApp();
    } catch (err) {
      showSplashError(err.message);
    }
  }

  async function newInstance() {
    if (!confirm('Provision a new instance? All data in the current instance will be lost.')) return;
    localStorage.removeItem(STORAGE_KEY);
    document.getElementById('app').style.display = 'none';
    const splash = document.getElementById('splash');
    splash.style.display = 'flex';
    splash.classList.remove('hidden');
    document.querySelector('.spinner-wrap').style.display = 'flex';
    document.getElementById('splash-error').style.display = 'none';
    await init(true);
  }

  function retryInit() {
    document.querySelector('.spinner-wrap').style.display = 'flex';
    document.getElementById('splash-error').style.display = 'none';
    init(false);
  }

  init(false);
</script>
</body>
</html>
